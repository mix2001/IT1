<!DOCTYPE html>
<html lang="nb" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Upload</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
    <script src="firebase.js"></script>

  </head>
  <body>
    <header>
      <div class="logobox">
        <div class="logo">
          <img src="bilder/logo.png" alt="logo">
        </div>
      </div>
      <nav>
        <div class="nav-bar">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="songs.html">Songs</a></li>
            <li><a id="active" href="upload.html">Upload</a></li>
          </ul>
        </div>
      </nav>
    </header>
    <main>
      <div class="upload-box">
        <h2>Upload</h2>
        <input type="text" id="songName" name="songName" placeholder="Song name...">
        <input type="file" id="fileButton" multiple accept="audio/*">
        <label class="button" for="fileButton">Select file</label>
          <button class="button" type="button" onclick="uploadFile(fileButton)">Upload</button>
          <progress value="0" max="100" id="uploader">0%</progress>
      </div>

    </main>
    <footer>
      <div class="footerInfo">
        <p>All right reserve Musicshare Â©</p>
      </div>
    </footer>
    <script type="text/javascript">
    var uploader = document.getElementById('uploader');
    var fileButton = document.getElementById('fileButton');
    var songName = document.getElementById('songName')

    //fileButton.addEventListener('change', );

    function uploadFile(e){
    //Get file
    var file = e.files[0];

    //Create storage reference
    var storageRef = firebase.storage().ref('MusicUpload/' + songName.value);

    //Upload file
    var task = storageRef.put(file);

    //Update progressbar
    task.on('state_changed',

    function progress(snapshot){
    var percentage = (snapshot.bytesTransferred /
    snapshot.totalBytes)* 100;
    uploader.value = percentage;
    },

    function error(err) {

    },

    function complete(){

    var postKey = firebase.database().ref('MusicUpload/').push().key;
    var downloadURL = task.snapshot.downloadURL;
    var updates = {};
    var postData = {
      name: songName,
      url: downloadURL
    };
    updates['/MusicUpload/'+ postKey] = postData;
    firebase.database().ref().update(updates)
    }


  );
};



    </script>
  </body>
</html>
